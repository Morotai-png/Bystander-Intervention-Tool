<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bystander Intervention Interactive Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        /* Tailwind CSS Configuration for custom colors */
        .tailwind-config {
            display: none; /* Hide this div */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'anu-gold': '#C69214',
                        'anu-black': '#000000',
                        'anu-white': '#FFFFFF',
                        'anu-beige': '#F4F4F4',
                        'pastel-green': '#D1FAE5', /* Lighter pastel green for consequences */
                        'red-danger': '#DC2626',
                        'red-dark': '#B91C1C',
                        'gray-light': '#9CA3AF',
                    }
                }
            }
        }
</script>
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F4F4F4; /* ANU Beige */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to start to allow scrolling */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto; /* Enable scrolling for the body */
        }
        .screen-container {
            background-color: #FFFFFF; /* ANU White */
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 850px;
            width: 100%;
            padding: 32px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
            justify-content: center;
            align-items: center;
        }
        .hidden-screen {
            display: none !important; /* Use !important to override flex display */
        }

        /* Specific screen styles - each acts as a "page" */
        #landing-page, #scenario-selection-page, #game-page {
            min-height: 100vh; /* Make each page take at least full viewport height */
            width: 100%; /* Ensure they span full width */
            display: flex; /* Default display for these sections */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 24px;
            box-sizing: border-box; /* Include padding in height calculation */
            padding-top: 20px; /* Add some padding to top/bottom */
            padding-bottom: 20px;
            position: relative; /* For menu button positioning */
        }
        /* Landing Page Specifics */
        #landing-page h4 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 500; /* font-medium */
            color: #4B5563; /* gray-700 */
        }
        #landing-page h1 {
            font-size: 3rem; /* text-5xl */
            font-weight: 700; /* font-bold */
            color: #C69214; /* anu-gold */
        }
        #landing-page p {
            font-size: 1.2rem;
            color: #1A1A1A; /* ANU Black for text */
            margin-bottom: 20px;
        }
        #landing-page .acknowledgement-text {
            font-size: 1.1rem;
            font-style: italic;
            color: #1A1A1A;
            line-height: 1.6;
            max-width: 90%;
            margin-bottom: 30px;
        }
        .start-button {
            background-color: #000000; /* ANU Black */
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .start-button:hover {
            background-color: #333333; /* Slightly lighter black */
            transform: translateY(-2px);
        }

        /* Scenario Selection Page */
        #scenario-selection-page h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #1A1A1A; /* ANU Black */
            margin-bottom: 30px;
        }
        .scenario-selection-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 700px;
        }
        .scenario-select-button {
            background-color: #C69214; /* ANU Gold */
            color: white;
            padding: 20px 15px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(198, 146, 20, 0.2);
            border: none;
            font-size: 1.05rem;
            text-align: center;
        }
        .scenario-select-button:hover {
            background-color: #A87E12; /* Darker ANU Gold */
            transform: translateY(-2px);
        }

        /* Game Page Specifics */
        #game-page .game-title {
            font-size: 3rem; /* Larger title for the game page */
            font-weight: 700;
            color: #1A1A1A; /* ANU Black for text */
            margin-bottom: 20px;
        }

        .scenario-box {
            background-color: #F4F4F4; /* ANU Beige */
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 1.1rem;
            color: #1A1A1A; /* ANU Black */
            line-height: 1.6;
            transition: background-color 0.5s ease; /* Smooth transition for color change */
        }
        .scenario-box.final-scenario {
            background-color: #E0FFFF; /* Light Cyan for final step */
        }
        .scenario-box h3 { /* Style for the "Part X" heading */
            font-size: 1.2rem;
            font-weight: 600;
            color: #1A1A1A;
            margin-bottom: 8px;
        }

        .consequence-box {
            background-color: #C69214; /* ANU Gold for consequences */
            color: white; /* White text for contrast */
            border-radius: 12px;
            padding: 24px;
            margin-top: 16px; /* Adjusted margin */
            text-align: left;
            font-size: 1rem;
            line-height: 1.5;
            display: none;
            border: 1px solid transparent; /* Default transparent border */
            width: 100%; /* Ensure it takes full width */
        }
        .consequence-box.positive {
            border-color: #000000; /* ANU Black */
        }
        .consequence-box.negative {
            border-color: #DC2626; /* Red for negative */
        }
        /* Neutral has no special border */

        .d-button {
            background-color: #000000; /* ANU Black */
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            border: none;
            flex-grow: 1;
            min-width: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.95rem;
        }
        .d-button strong {
            font-size: 1.05em;
            margin-bottom: 2px;
        }
        .d-button span {
            font-size: 0.8em;
            opacity: 0.9;
        }
        .d-button select {
            background-color: #C69214; /* Slightly lighter black */
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        .d-button cant-combine {
            background-color: #9CA3AF; /* Slightly lighter black */
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .d-button:hover {
            background-color: #333333; /* Slightly lighter black */
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        .d-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .d-button.do-nothing {
            background-color: #DC2626; /* Red for 'Do Nothing' */
            box-shadow: 0 4px 10px rgba(220, 38, 38, 0.2);
        }
        .d-button.do-nothing:hover {
            background-color: #B91C1C; /* Darker Red */
            box-shadow: 0 6px 15px rgba(220, 38, 38, 0.3);
        }
        .d-button:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            justify-content: center;
            width: 100%; /* Ensure it takes full width */
        }
        @media (max-width: 768px) {
            .button-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (max-width: 480px) {
            .button-grid {
                grid-template-columns: 1fr;
            }
        }
        .action-area {
            display: flex;
            flex-direction: column;
            gap: 16px;
            align-items: center;
            margin-top: 16px; /* Margin above action buttons */
            width: 100%; /* Ensure it takes full width */
        }
        .game-control-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            width: 100%; /* Ensure it takes full width */
        }
        .game-control-buttons button {
            background-color: #000000; /* ANU Black */
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            flex-grow: 1;
            min-width: 150px;
        }
        .game-control-buttons button:hover {
            background-color: #333333; /* Darker black */
        }
        .game-control-buttons button.restart-scenario-button {
            background-color: #DC2626; /* Red for restart */
        }
        .game-control-buttons button.restart-scenario-button:hover {
            background-color: #B91C1C; /* Darker Red */
        }
        .game-control-buttons button.continue-button-gold {
            background-color: #C69214; /* ANU Gold for continue */
        }
        .game-control-buttons button.continue-button-gold:hover {
            background-color: #A87E12; /* Darker ANU Gold */
        }

        .game-control-buttons button.seeNextPart-button-gold {
            background-color: #A87E12; /* Darker ANU Gold */
        }


        /* Menu Button */
        .menu-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: #000000; /* ANU Black */
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            z-index: 50;
        }
        .menu-button:hover {
            background-color: #333333; /* Darker ANU Black */
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .modal-content {
            background-color: #FFFFFF; /* ANU White */
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            position: relative;
            text-align: left;
            color: #1A1A1A; /* ANU Black */
            line-height: 1.6;
        }
        .modal-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #1A1A1A; /* ANU Black */
        }
        .modal-content p {
            margin-bottom: 10px;
        }
        .close-button {
            color: #1A1A1A; /* ANU Black */
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        .loading-spinner {
            border: 4px solid #F4F4F4; /* ANU Beige */
            border-top: 4px solid #000000; /* ANU Black */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .menu-list {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
        }
        .menu-list li {
            margin-bottom: 10px;
        }
        .menu-list a {
            color: #1A1A1A; /* ANU Black */
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        .menu-list a:hover {
            color: #333333;
        }
        .menu-section-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #1A1A1A; /* ANU Black */
            border-bottom: 1px solid #F4F4F4; /* ANU Beige border */
            padding-bottom: 5px;
        }

        /* Mobile responsiveness */
        @media (max-width: 640px) {
            .screen-container {
                padding: 20px;
                gap: 12px;
            }
            #landing-page, #scenario-selection-page, #game-page {
                min-height: 80vh; /* Adjust for smaller screens if 100vh is too much */
                padding-top: 15px;
                padding-bottom: 15px;
            }
            .scenario-box {
                font-size: 0.95rem;
                padding: 16px;
            }
            .consequence-box {
                font-size: 0.85rem;
                padding: 16px;
            }
            .d-button {
                padding: 10px 15px;
                font-size: 0.85rem;
                min-width: unset;
                width: 100%;
            }
            .button-grid {
                grid-template-columns: 1fr;
            }
            .modal-content {
                padding: 20px;
            }
            .modal-content h3 {
                font-size: 1.2rem;
            }
            .menu-button {
                top: 10px;
                left: 10px;
                padding: 8px 12px;
                font-size: 0.8rem;
            }
            .game-control-buttons {
                flex-direction: column;
                gap: 10px;
            }
            .game-control-buttons button {
                width: 100%;
            }
            #landing-page h4 { font-size: 1rem; }
            #landing-page h1 { font-size: 2.2rem; }
            #landing-page p { font-size: 0.9rem; }
            #landing-page .acknowledgement-text { font-size: 0.8rem; }
            #scenario-selection-page h2 { font-size: 1.3rem; }
            .scenario-selection-grid {
                grid-template-columns: 1fr;
            }
            .scenario-select-button {
                padding: 12px 10px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="screen-container">
        <div id="landing-page">
            <button id="menu-button-landing" class="menu-button">Menu</button>
            <div id="top-of-page" class="flex flex-col items-center">
                <h4 class="text-xl font-medium text-gray-700">Inclusive and Respectful Communities present</h4>
                <h1 class="text-5xl font-bold text-anu-gold">A Bystander Intervention Tool</h1>
            </div>
            <p>Learn to make a difference in moments that matter.</p>
            <p class="acknowledgement-text">"The Australian National University acknowledges, celebrates and pays our respects to the Ngunnawal and Ngambri people of the Canberra region and to all First Nations Australians on whose traditional lands we meet and work, and whose cultures are among the oldest continuing cultures in human history."</p>
            <button id="start-game-button" class="start-button">Let's begin</button>
        </div>

        <div id="scenario-selection-page" class="hidden-screen">
            <button id="menu-button-selection" class="menu-button">Menu</button>
            <h2>Where would you like to start?</h2>
            <div class="scenario-selection-grid">
                <button class="scenario-select-button" data-start-scenario="tutorial_microaggression">Go to your tute</button>
                <button class="scenario-select-button" data-start-scenario="res_hall_loud_music">Spend time in a Residential Hall</button>
                <button class="scenario-select-button" data-start-scenario="club_meet_exclusion">Attend a Club Meet</button>
                <button class="scenario-select-button" data-start-scenario="sports_team_exclusion">Play Sports</button>
                <button class="scenario-select-button" data-start-scenario="coffee_shop_queue">Go get a Coffee</button>
                <button class="scenario-select-button" data-start-scenario="bathroom_graffiti">Go to the Bathroom</button>
            </div>
        </div>

        <div id="game-page" class="hidden-screen">
            <button id="menu-button-game" class="menu-button">Menu</button>

            <h1 id="game-page-title" class="game-title"></h1>

            <div id="scenario-display" class="scenario-box">
                <h3 id="scenario-part-number"></h3>
                <p id="scenario-description"></p>
            </div>

            <div class="action-area">
                <div class="button-grid" id="action-buttons">
                    <button class="d-button" data-action="direct">
                        <strong>Direct</strong>
                        <span data-description-for="direct"></span>
                    </button>
                    <button class="d-button" data-action="distract">
                        <strong>Distract</strong>
                        <span data-description-for="distract"></span>
                    </button>
                    <button class="d-button" data-action="delegate">
                        <strong>Delegate</strong>
                        <span data-description-for="delegate"></span>
                    </button>
                    <button class="d-button" data-action="delay">
                        <strong>Delay</strong>
                        <span data-description-for="delay"></span>
                    </button>
                    <button class="d-button" data-action="document">
                        <strong>Document</strong>
                        <span data-description-for="document"></span>
                    </button>
                    <button class="d-button do-nothing" data-action="do-nothing">
                        <strong>Do Nothing</strong>
                        <span data-description-for="do-nothing"></span>
                    </button>
                </div>
            </div>

            <div id="consequence-display" class="consequence-box">
                </div>

            <div class="game-control-buttons">
                <button id="restart-scenario-button" class="restart-scenario-button" style="display: none;">Restart This Scenario</button>
                <button id="continue-button" class="continue-button-gold" style="display: none;">See What Happens Next</button>
            </div>
        </div>
    </div>

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <span class="close-button" data-modal-target="menuModal">&times;</span>
            <h3>Game Menu</h3>

            <h4 class="menu-section-title">Navigation</h4>
            <ul data-section="navigation" class="menu-list">
                </ul>

            <h4 class="menu-section-title">Choose Scenario</h4>
            <ul id="scenario-list" class="menu-list">
                </ul>

            <h4 class="menu-section-title">Support & Reporting</h4>
            <ul class="menu-list">
                <li><a href="https://www.anu.edu.au/students/health-safety-wellbeing/student-support" target="_blank" rel="noopener noreferrer">ANU Student Support Services</a></li>
                <li><a href="https://www.anu.edu.au/students/health-safety-wellbeing/counselling" target="_blank" rel="noopener noreferrer">ANU Counselling Centre</a></li>
                <li><a href="https://www.anu.edu.au/about/governance/committees/equity-and-diversity-committee" target="_blank" rel="noopener noreferrer">ANU Equity & Diversity Office</a></li>
                <li><a href="https://anu-advocate.symplicity.com/sash_report/index.php/pid715548?" target="_blank" rel="noopener noreferrer">Harmful Disclosure Tool</a></li>
                <li><a href="https://www.lifeline.org.au/" target="_blank" rel="noopener noreferrer">Lifeline (Australia) - 13 11 14</a></li>
            </ul>
        </div>
    </div>

    <audio id="hoverSound" src="https://assets.mixkit.co/sfx/preview/mixkit-game-bling-2000.mp3" preload="auto"></audio>
    <audio id="clickSound" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-click-1869.mp3" preload="auto"></audio>

    <script>
        // Game state variables
        let currentScenarioId = null;   // Start with no scenario loaded
        let gameActive = false;         //
        let lastChosenAction = null;    // To store the last action for reflection
        let currentPartNumber = 0;      // Tracks the current part number within a scenario

        // DOM Elements
        const landingPage = document.getElementById('landing-page');
        const scenarioSelectionPage = document.getElementbyId('scenario-selection-page');
        const gamePage = document.getElementById('game-page');

        const startGameButton = document.getElementById('start-game-button');
        const scenarioSelectButtons = document.querySelectorAll('.scenario-select-button');

        const gamePageTitle = document.getElementbyId('start-game-button');
        const scenarioPartNumber = document.getElementById('scenario-part-number');         // Element for part number
        const scenarioDescriptionDisplay = document.getElementById('scenario-description'); // Element for scenario description
        const scenarioBox = document.getElementById('scenario-display');                    // Reference to the scenario box

        const consequenceDisplay = document.getElementById('consequence-display');
        const actionButtonsContainer = document.getElementById('action-buttons');
        const buttons = actionButtonsContainer.querySelectorAll('.d-button');
        const continueButton = document.getElementById('continue-button');
        const restartScenarioButton = document.getElementById('restart-scenario-button');

        // Menu elements
        const menuButtonLanding = document.getElementById('menu-button-landing');
        const menuButtonSelection = document.getElementById('menu-button-selection');
        const menuButtonGame = document.getElementById('menu-button-game');
        const menuModal = document.getElementById('menuModal');
        const menuModalCloseButton = menuModal.querySelector('.close-button');
        const scenarioList = document.getElementById('scenario-list');
        const menuNavList = menuModal.querySelector('.menu-list[data-section="navigation"]'); // Get the navigation list

        // Audio elements
        const hoverSound = document.getElementById('hoverSound');
        const clickSound = document.getElementById('clickSound');


        var tutorial1 = {title:"Tutorial",
                        description:"The 'Joke' in the Tutorial", 
                        text: "During a lively tutorial discussion on Australian history, " + 
                            "a student named Mark makes a 'joke' about a particular cultural group's intelligence, " +
                            "implying they are less capable. Another student, Priya, who is from that cultural background, " +
                            "visibly flinches and looks down, becoming quiet for the rest of the session. " + 
                            "The tutor seems to ignore it, moving on quickly.",
                        choices: {
                            direct:  "Address Mark directly about his comment.",
                            distract:"Shift the conversation away from Mark's comment.",
                            delegate:"Speak to the tutor after the session.",
                            delay:   "Check in with Priya after the tutorial.",
                            document:"Make a disclosure using the Harmful Disclosure Tool.",
                            nothing: "Remain silent and observe." 
                        },
                        consequences: { 
                            direct: {
                                text:"You calmly but firmly interject, 'Mark, that comment isn't appropriate " + 
                                    "and it's based on a harmful stereotype. It makes the learning environment " + 
                                    "uncomfortable for others.' Mark looks embarrassed and mumbles an apology. " + 
                                    "Priya looks up, surprised and grateful. The tutor then addresses the class, " + 
                                    "reinforcing respectful discussion. Mark's behaviour is challenged, and Priya " + 
                                    "feels seen and supported, improving the tutorial environment.",
                                type: "positive",
                                combine: (["delegate", "delay", "document"]),
                            },
                            distract: {
                                text: "You loudly 'realise' you've forgotten your textbook " + 
                                    "and ask the tutor a complex, off-topic question about " + 
                                    "the next week's reading, shifting the focus. The tutor " + 
                                    "is momentarily sidetracked, and the conversation moves away " +
                                    "from Mark's comment. Priya gets a moment to compose herself, " + 
                                    "and the immediate tension dissipates. While the comment wasn't " + 
                                    "directly addressed, the situation was defused.",
                                type: "neutral",
                                combine: (["delegate", "delay", "document"]), 
                            },
                            delegate: {
                                text: "After the tutorial, you discreetly approach the tutor and explain what Mark " +
                                    "said and how it affected Priya. You suggest the tutor address it with Mark or " + 
                                    "the class. The tutor thanks you, acknowledging the importance of a safe space, " + 
                                    "and confirms they will follow up. This ensures the issue is handled by someone in " + 
                                    "authority, potentially leading to educational outcomes for Mark and systemic change.",
                                    type: "positive",
                                    combine:(["direct", "distract", "delay", "document"])
                            },
                            delay: { 
                                text: "After the tutorial ends, you approach Priya and say, 'I'm so sorry about what Mark said. " + 
                                    "That was completely out of line. Are you okay?' Priya expresses her frustration and hurt. " + 
                                    "You listen empathetically, validate her feelings, and offer to walk her to the student " + 
                                    "support services if she wants to report it. While the incident wasn't stopped, you provided " + 
                                    "crucial emotional support and a pathway for further action.",
                                type: "positive",
                                combine: (["direct", "distract", "delegate", "document"])
                            },
                            document: { 
                                text: "You quickly open a note on your phone and jot down Mark's exact words, the time, " + 
                                    "date, and the context of the tutorial. You also note Priya's reaction and " + 
                                    "the tutor's inaction. The incident plays out as you record. You now have detailed " + 
                                    "evidence that could be used if Priya or someone else decides to make a formal complaint " + 
                                    "to the university's equity office. However, the immediate impact on Priya remains.",
                                type: "neutral",
                                combine: (["direct", "distract", "delegate", "delay"])
                            },
                            nothing: {
                                text: "You remain silent, feeling uncomfortable but unsure what to do. The tutorial continues " + 
                                        "as if nothing happened. Priya remains withdrawn and quiet. Mark's behaviour goes " + 
                                        "unchallenged, potentially reinforcing his belief that such comments are acceptable. " + 
                                        "Priya feels isolated and unsupported, and the learning environment is subtly diminished " + 
                                        "for students from diverse backgrounds.",
                                type: "negative",
                                combine: ([])
                            }
                        }
        };
        
        // Function to show a specific screen and hide others, with scrolling
        function showScreen(screenId) {
            const screens = [landingPage, scenarioSelectionPage, gamePage];
            screens.forEach(screen => {
                screen.classList.add('hidden-screen'); // Hide all screens
            });

            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden-screen'); // Show the target screen
                
                // Scroll to the top of the target screen
                targetScreen.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Function to load a scenario
        function loadScenario(scenarioId) {
            const scenario = scenarios[scenarioId];
            if (!scenario) {
                console.error("Scenario not found:", scenarioId);
                scenarioDescriptionDisplay.innerHTML = `<p>Error! Could not load the next part of the story. Please restart the game from the menu.</p>`;
                return;
            }

            currentScenarioId = scenarioId;
        // Set part number or "In the end..."
            if (scenario.isEnding) {
                scenarioPartNumber.textContent = "In the end...";
                scenarioBox.classList.add('final-scenario'); // Add class for final scenario color
                scenarioDescriptionDisplay.innerHTML = `<p>${scenario.description}</p>`; // No "What do you do?" for endings
            } else {
                // If it's a new scenario (initial load from selection or restart), set to 1.
                // Otherwise, it means we're continuing, and currentPartNumber was already incremented.
                if (currentPartNumber === 0) { // Only set to 1 if it's a fresh start
                    currentPartNumber = 1;
                }
                scenarioPartNumber.textContent = `Part ${currentPartNumber}`;
                scenarioBox.classList.remove('final-scenario'); // Remove class if not final
                scenarioDescriptionDisplay.innerHTML = `<p>${scenario.description}</p><p>What do you do?</p>`; // Add "What do you do?"
            }

            gamePageTitle.textContent = scenario.title; // Set dynamic game page title

            actionButtonsContainer.style.display = 'grid'; // Show action buttons
            consequenceDisplay.style.display = 'none'; // Hide consequences
            consequenceDisplay.className = 'consequence-box'; // Reset consequence box styling
            enableButtons();
            continueButton.style.display = 'none'; // Hide continue button
            restartScenarioButton.style.display = 'none'; // Hide restart scenario button
            gameActive = true;
            analyzeScenarioButton.style.display = 'block'; // Show Analyze button
            reflectOutcomeButton.style.display = 'none'; // Hide Reflect button

            // Update button descriptions based on the current scenario
            buttons.forEach(button => {
                const action = button.dataset.action;
                const descriptionSpan = button.querySelector(`span[data-description-for="${action}"]`);
                if (descriptionSpan && scenario.buttonDescriptions[action]) {
                    descriptionSpan.textContent = scenario.buttonDescriptions[action];
                } else {
                    descriptionSpan.textContent = getGenericDescription(action);
                }
            });

            // If it's an ending scenario, disable buttons and show only "Play Again"
            if (scenario.isEnding) {
                displayConsequences('final'); // Display the final consequence
                actionButtonsContainer.style.display = 'none'; // Hide action buttons for ending
                disableButtons();
                analyzeScenarioButton.style.display = 'none'; // Hide Analyze button at ending
                reflectOutcomeButton.style.display = 'none'; // Hide Reflect button at ending
                restartScenarioButton.style.display = 'none'; // No restart scenario at final ending
                continueButton.textContent = 'Play Again';
                continueButton.style.display = 'block';
                gameActive = false;
            }
            showScreen('game-page'); // Ensure game page is visible and scrolled to
        }

        // Helper for generic descriptions if specific ones are missing
        function getGenericDescription(action) {
            switch (action) {
                case 'direct': return "Address the situation directly.";
                case 'distract': return "Create a diversion to interrupt.";
                case 'delegate': return "Find someone in authority to help.";
                case 'delay': return "Check in with the person after the event.";
                case 'document': return "Make a disclosure using the Harmful Disclosure Tool.";
                case 'do-nothing': return "Choose not to intervene."; // Corrected syntax
                default: return "";
            }
        }

        // Function to display consequences
        function displayConsequences(action) {
            const scenario = scenarios[currentScenarioId];
            const chosenConsequence = scenario.consequences[action];

            if (chosenConsequence) {
                consequenceDisplay.innerHTML = `<p>${chosenConsequence.text}</p>`;
                consequenceDisplay.style.display = 'block';
                consequenceDisplay.classList.add(chosenConsequence.type);
            }
            actionButtonsContainer.style.display = 'none'; // Hide action buttons
            disableButtons();
            analyzeScenarioButton.style.display = 'none';
            reflectOutcomeButton.style.display = 'block';
            seeNextPartButton.textContent = 'See What Happens Next';
            seeNextPartButton.style.display = 'block';
            restartScenarioButton.style.display = 'block';
            lastChosenAction = action;

            if (scenario.isEnding) {
                seeNextPartButton.textContent = 'Play Again';
                reflectOutcomeButton.style.display = 'none';
                restartScenarioButton.style.display = 'none';
            }
        }

        // Function to enable all action buttons
        function enableButtons() {
            buttons.forEach(button => {
                button.disabled = false;
            });
        }

        // Function to disable all action buttons
        function disableButtons() {
            buttons.forEach(button => {
                button.disabled = true;
            });
        }

        // Function to reset the game (full restart from landing page)
        function resetGame() {
            currentScenarioId = null;
            gameActive = false;
            currentPartNumber = 0; // Reset part number
            showScreen('landing-page');
        }

        // Menu Modal Logic
        menuButtonLanding.addEventListener('click', () => {
            menuModal.style.display = 'flex';
            populateMenuNavigation(); // Populate navigation links
            populateScenarioList(); // Populate scenario links
        });
        menuButtonSelection.addEventListener('click', () => {
            menuModal.style.display = 'flex';
            populateMenuNavigation(); // Populate navigation links
            populateScenarioList(); // Populate scenario links
        });
        menuButtonGame.addEventListener('click', () => {
            menuModal.style.display = 'flex';
            populateMenuNavigation(); // Populate navigation links
            populateScenarioList(); // Populate scenario links
        });

        menuModalCloseButton.addEventListener('click', () => {
            menuModal.style.display = 'none';
        });

        function populateMenuNavigation() {
            menuNavList.innerHTML = ''; // Clear existing navigation list

            const homeItem = document.createElement('li');
            const homeLink = document.createElement('a');
            homeLink.href = '#top-of-page'; // Anchor link to the top of the landing page
            homeLink.textContent = 'Home (Landing Page)';
            homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                menuModal.style.display = 'none';
                showScreen('landing-page');
                // Use smooth scroll to top of the page after showing it
                document.getElementById('top-of-page').scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
            homeItem.appendChild(homeLink);
            menuNavList.appendChild(homeItem);

            const newGameItem = document.createElement('li');
            const newGameLink = document.createElement('a');
            newGameLink.href = '#';
            newGameLink.textContent = 'Start New Game (Scenario Selection)';
            newGameLink.addEventListener('click', (e) => {
                e.preventDefault();
                menuModal.style.display = 'none';
                showScreen('scenario-selection-page');
            });
            newGameItem.appendChild(newGameLink);
            menuNavList.appendChild(newGameItem);
        }

        function populateScenarioList() {
            scenarioList.innerHTML = ''; // Clear existing list
            // Add all initial scenarios to the menu for starting points
            const initialScenarioOptions = [
                { id: 'tutorial_microaggression', text: 'Go to your tute' },
                { id: 'res_hall_loud_music', text: 'Spend time in a Residential Hall' },
                { id: 'club_meet_exclusion', text: 'Attend a Club Meet' },
                { id: 'sports_team_exclusion', text: 'Play Sports' },
                { id: 'coffee_shop_queue', text: 'Go get a Coffee' },
                { id: 'bathroom_graffiti', text: 'Go to the Bathroom' }
            ];
        
            initialScenarioOptions.forEach(option => {
                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = '#';
                link.textContent = option.text;
                link.dataset.scenarioId = option.id;
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    menuModal.style.display = 'none';
                    currentPartNumber = 0; // Reset part number for a new scenario start
                    loadScenario(option.id); // Load selected scenario
                });
                listItem.appendChild(link);
                scenarioList.appendChild(listItem);
            });
        }

        // Buttons
        buttons.forEach(button => {
            button.addEventListener('mouseenter', () => {
                hoverSound.currentTime = 0; // Rewind to start
                hoverSound.play().catch(e => console.log("Hover audio play failed:", e)); // Play and catch potential errors
            });
            button.addEventListener('click', (event) => {
                clickSound.currentTime = 0; // Rewind to start
                clickSound.play().catch(e => console.log("Click audio play failed:", e)); // Play and catch potential errors

                if (gameActive) {
                    const action = event.target.closest('.d-button')?.dataset.action;
                    if (action) {
                        // displayConsequences(action);
                        var choiceList









                    }
                }
            });
        });

        // Event listener for Start Game button
        startGameButton.addEventListener('click', () => {
            showScreen('scenario-selection-page');
            populateScenarioList();                      // Ensure scenario list is populated for menu
        });

        // Event listeners for scenario selection buttons
        scenarioSelectButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const scenarioId = event.target.dataset.startScenario;
                currentPartNumber = 0; // Reset part number for a new scenario start
                loadScenario(scenarioId);
            });
        });


        // Event listener for continue/play again button
        continueButton.addEventListener('click', () => {
            const scenario = scenarios[currentScenarioId];
            if (scenario.isEnding) {
                showScreen('scenario-selection-page'); // Go to scenario selection page
            } else {
                if (lastChosenAction && scenario.consequences[lastChosenAction]?.nextScenarioId) {
                    currentPartNumber++; // Increment part number for the next part of the scenario
                    loadScenario(scenario.consequences[lastChosenAction].nextScenarioId);
                } else {
                    console.error("Next scenario ID not found. Restarting game.");
                    showScreen('scenario-selection-page'); // Fallback to scenario selection
                }
            }
        });

        // Event listener for continue/play again button
        seeNextPartButton.addEventListener('click', () => {
            const scenario = scenarios[currentScenarioId];
            if (scenario.isEnding) {
                showScreen('scenario-selection-page'); // Go to scenario selection page
            } else {
                if (lastChosenAction && scenario.consequences[lastChosenAction]?.nextScenarioId) {
                    currentPartNumber++; // Increment part number for the next part of the scenario
                    loadScenario(scenario.consequences[lastChosenAction].nextScenarioId);
                } else {
                    console.error("Next scenario ID not found. Restarting game.");
                    showScreen('scenario-selection-page'); // Fallback to scenario selection
                }
            }
        });

        // Event listener for restart scenario button
        restartScenarioButton.addEventListener('click', () => {
            const originalScenarioId = currentScenarioId; // Keep the current scenario ID
            currentPartNumber = 0; // Reset part number to re-start the scenario from Part 1
            loadScenario(originalScenarioId); // Reload the same scenario
        });

        // Initial game load: show landing page
        window.onload = () => {
            showScreen('landing-page');
            // Ensure navigation links are populated on load for the menu
            populateMenuNavigation();
            populateScenarioList();
        };
    </script>
</body>
</html>